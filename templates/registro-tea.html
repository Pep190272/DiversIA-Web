{% extends "base.html" %}

{% block title %}Registro TEA - DiversIA{% endblock %}
{% block meta_description %}Registro específico para personas con TEA (Trastorno del Espectro Autista). Encuentra trabajo adaptado a tus fortalezas.{% endblock %}

{% block content %}
<section class="registration-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="text-center mb-5">
                    <div class="neurodiversity-badge tea mb-3">
                        <i data-lucide="puzzle" aria-hidden="true"></i>
                        TEA
                    </div>
                    <h1 class="mb-3">Registro TEA</h1>
                    <p class="lead">
                        Formulario diseñado para personas en el espectro autista, 
                        con estructura clara y preguntas específicas.
                    </p>
                </div>

                <div class="card">
                    <div class="card-body p-4">
                        <form method="POST" novalidate>
                            {{ form.hidden_tag() }}
                            <!-- Campo oculto para tipo de neurodivergencia -->
                            {{ form.tipo_neurodivergencia(style="display: none;") }}
                            
                            <!-- Información Personal -->
                            <div class="form-section mb-5">
                                <h3 class="form-section-title">
                                    <i data-lucide="user" aria-hidden="true"></i>
                                    Información Personal
                                </h3>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ form.nombre.label(class="form-label required") }}
                                        {{ form.nombre(class="form-control" + (" is-invalid" if form.nombre.errors else "")) }}
                                        {% if form.nombre.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.nombre.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form.apellidos.label(class="form-label required") }}
                                        {{ form.apellidos(class="form-control" + (" is-invalid" if form.apellidos.errors else "")) }}
                                        {% if form.apellidos.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.apellidos.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ form.email.label(class="form-label required") }}
                                        {{ form.email(class="form-control" + (" is-invalid" if form.email.errors else "")) }}
                                        {% if form.email.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.email.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form.fecha_nacimiento.label(class="form-label required") }}
                                        {{ form.fecha_nacimiento(class="form-control" + (" is-invalid" if form.fecha_nacimiento.errors else "")) }}
                                        {% if form.fecha_nacimiento.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.fecha_nacimiento.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ form.telefono.label(class="form-label") }}
                                        {{ form.telefono(class="form-control") }}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form.ciudad.label(class="form-label") }}
                                        {{ form.ciudad(class="form-control") }}
                                    </div>
                                </div>
                            </div>

                            <!-- Información específica de TEA -->
                            <div class="form-section mb-5 tea-section">
                                <h3 class="form-section-title">
                                    <i data-lucide="brain" aria-hidden="true"></i>
                                    Perfil TEA
                                </h3>
                                
                                <div class="mb-4">
                                    {{ form.nivel_comunicacion.label(class="form-label") }}
                                    {{ form.nivel_comunicacion(class="form-select") }}
                                    <div class="form-text">
                                        Esta información nos ayuda a entender tus fortalezas comunicativas.
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="form-label">Sensibilidades sensoriales</label>
                                    <div class="form-text mb-3">Marca las sensibilidades que experimentas:</div>
                                    <div class="row">
                                        {% for subfield in form.sensibilidades_sensoriales %}
                                            <div class="col-md-6 mb-2">
                                                <div class="form-check">
                                                    {{ subfield(class="form-check-input") }}
                                                    {{ subfield.label(class="form-check-label") }}
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <div class="form-text mt-2">
                                        Conocer tus sensibilidades nos ayuda a encontrar entornos laborales apropiados.
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    {{ form.rutinas_importantes.label(class="form-label") }}
                                    {{ form.rutinas_importantes(class="form-select") }}
                                    <div class="form-text">
                                        Las rutinas pueden ser importantes para tu bienestar y productividad.
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    {{ form.intereses_especiales.label(class="form-label") }}
                                    {{ form.intereses_especiales(class="form-control", rows="4", placeholder="Ej: tecnología, matemáticas, arte, música, ciencias, colecciones...") }}
                                    <div class="form-text">
                                        Los intereses especiales pueden ser grandes fortalezas profesionales.
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    {{ form.diagnostico_formal.label(class="form-label") }}
                                    {{ form.diagnostico_formal(class="form-select") }}
                                    <div class="form-text">
                                        Un diagnóstico formal puede ayudar pero no es imprescindible para encontrar trabajo.
                                    </div>
                                </div>
                            </div>

                            <!-- Información Profesional -->
                            <div class="form-section mb-5">
                                <h3 class="form-section-title">
                                    <i data-lucide="briefcase" aria-hidden="true"></i>
                                    Experiencia Profesional
                                </h3>
                                
                                <div class="mb-3">
                                    {{ form.experiencia_laboral.label(class="form-label") }}
                                    {{ form.experiencia_laboral(class="form-control", rows="4") }}
                                    <div class="form-text">
                                        Incluye tanto experiencia laboral formal como proyectos personales relevantes.
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    {{ form.formacion_academica.label(class="form-label") }}
                                    {{ form.formacion_academica(class="form-control", rows="3") }}
                                </div>
                                
                                <div class="mb-3">
                                    {{ form.habilidades.label(class="form-label") }}
                                    {{ form.habilidades(class="form-control", rows="4", placeholder="Ej: atención al detalle, pensamiento sistemático, memoria excepcional, honestidad, lealtad...") }}
                                    <div class="form-text">
                                        Las personas en el espectro autista often tienen fortalezas únicas como atención al detalle y pensamiento sistemático.
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    {{ form.intereses_laborales.label(class="form-label") }}
                                    {{ form.intereses_laborales(class="form-control", rows="3") }}
                                </div>
                            </div>

                            <!-- Adaptaciones específicas para TEA -->
                            <div class="form-section mb-5">
                                <h3 class="form-section-title">
                                    <i data-lucide="settings" aria-hidden="true"></i>
                                    Adaptaciones para TEA
                                </h3>
                                
                                <div class="mb-3">
                                    {{ form.adaptaciones_necesarias.label(class="form-label") }}
                                    {{ form.adaptaciones_necesarias(class="form-control", rows="5", placeholder="Ej: ambiente tranquilo, rutinas predecibles, instrucciones claras por escrito, espacios sin ruidos fuertes, iluminación suave...") }}
                                    <div class="form-text">
                                        Describe detalladamente las adaptaciones que necesitas para trabajar cómodamente.
                                    </div>
                                </div>
                                
                                <div class="alert alert-info" role="alert">
                                    <div class="d-flex">
                                        <i data-lucide="star" class="me-2" aria-hidden="true"></i>
                                        <div>
                                            <strong>Fortalezas del TEA:</strong><br>
                                            Atención excepcional al detalle, pensamiento lógico y sistemático, 
                                            honestidad, lealtad y capacidad de concentración profunda en áreas de interés.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Progress indicator -->
                            <div class="progress mb-4" style="height: 8px;" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-label="Progreso del formulario">
                                <div class="progress-bar bg-info" style="width: 100%"></div>
                            </div>

                            <!-- Política de Privacidad -->
                            <div class="form-section mb-4">
                                <div class="form-check">
                                    {{ form.aceptar_privacidad(class="form-check-input" + (" is-invalid" if form.aceptar_privacidad.errors else "")) }}
                                    <label class="form-check-label" for="{{ form.aceptar_privacidad.id }}">
                                        He leído y acepto la <a href="{{ url_for('politica_privacidad') }}" target="_blank" class="text-decoration-none">Política de Privacidad</a>
                                    </label>
                                    {% if form.aceptar_privacidad.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in form.aceptar_privacidad.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="d-flex flex-column flex-sm-row gap-3 justify-content-between">
                                <a href="{{ url_for('personas_nd') }}" class="btn btn-outline-secondary">
                                    <i data-lucide="arrow-left" aria-hidden="true"></i>
                                    Volver
                                </a>
                                <button type="submit" class="btn btn-info btn-lg">
                                    <i data-lucide="check" aria-hidden="true"></i>
                                    Completar Registro TEA
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
// Form validation feedback for clear communication
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const requiredFields = form.querySelectorAll('[required]');
    
    // Add visual indicators for required fields
    requiredFields.forEach(field => {
        const label = form.querySelector(`label[for="${field.id}"]`);
        if (label && !label.querySelector('.required-indicator')) {
            const indicator = document.createElement('span');
            indicator.className = 'required-indicator text-danger ms-1';
            indicator.innerHTML = '*';
            indicator.setAttribute('aria-label', 'Campo obligatorio');
            label.appendChild(indicator);
        }
    });
    
    // Provide clear validation feedback
    form.addEventListener('submit', function(e) {
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
                field.classList.add('is-invalid');
                
                // Create or update error message
                let errorDiv = field.parentNode.querySelector('.invalid-feedback');
                if (!errorDiv) {
                    errorDiv = document.createElement('div');
                    errorDiv.className = 'invalid-feedback';
                    field.parentNode.appendChild(errorDiv);
                }
                errorDiv.textContent = 'Este campo es obligatorio';
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            // Focus on first invalid field
            const firstInvalid = form.querySelector('.is-invalid');
            if (firstInvalid) {
                firstInvalid.focus();
                firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });
    
    // Remove validation errors on input
    requiredFields.forEach(field => {
        field.addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('is-invalid');
            }
        });
    });
});
</script>
{% endblock %}
