<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Usuario - DiversIA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h4>‚úèÔ∏è Editar Perfil de Usuario</h4>
                        <a href="/usuarios-neurodivergentes" class="btn btn-sm btn-outline-secondary">‚Üê Volver al Dashboard</a>
                    </div>
                    <div class="card-body">
                        <form id="editUserForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Informaci√≥n Personal</h6>
                                    <div class="mb-3">
                                        <label class="form-label">Nombre</label>
                                        <input type="text" class="form-control" name="nombre" value="{{ user.nombre or '' }}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Apellidos</label>
                                        <input type="text" class="form-control" name="apellidos" value="{{ user.apellidos or '' }}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" name="email" value="{{ user.email or '' }}" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Tel√©fono</label>
                                        <input type="tel" class="form-control" name="telefono" value="{{ user.telefono or '' }}">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Ciudad</label>
                                        <input type="text" class="form-control" name="ciudad" value="{{ user.ciudad or '' }}">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Fecha de Nacimiento</label>
                                        <input type="date" class="form-control" name="fecha_nacimiento" 
                                               value="{{ user.fecha_nacimiento.strftime('%Y-%m-%d') if user.fecha_nacimiento else '' }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Informaci√≥n de Neurodivergencia</h6>
                                    <div class="mb-3">
                                        <label class="form-label">Tipo de Neurodivergencia</label>
                                        <select class="form-control" name="tipo_neurodivergencia">
                                            <option value="">Seleccionar...</option>
                                            <option value="TDAH" {{ 'selected' if user.tipo_neurodivergencia == 'TDAH' }}>TDAH</option>
                                            <option value="TEA" {{ 'selected' if user.tipo_neurodivergencia == 'TEA' }}>TEA</option>
                                            <option value="Dislexia" {{ 'selected' if user.tipo_neurodivergencia == 'Dislexia' }}>Dislexia</option>
                                            <option value="Discalculia" {{ 'selected' if user.tipo_neurodivergencia == 'Discalculia' }}>Discalculia</option>
                                            <option value="Disgraf√≠a" {{ 'selected' if user.tipo_neurodivergencia == 'Disgraf√≠a' }}>Disgraf√≠a</option>
                                            <option value="TEL" {{ 'selected' if user.tipo_neurodivergencia == 'TEL' }}>TEL</option>
                                            <option value="TPS" {{ 'selected' if user.tipo_neurodivergencia == 'TPS' }}>TPS</option>
                                            <option value="Tourette" {{ 'selected' if user.tipo_neurodivergencia == 'Tourette' }}>S√≠ndrome de Tourette</option>
                                            <option value="Superdotaci√≥n/Altas Capacidades" {{ 'selected' if user.tipo_neurodivergencia == 'Superdotaci√≥n/Altas Capacidades' }}>Altas Capacidades</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="diagnostico_formal" 
                                                   {{ 'checked' if user.diagnostico_formal }}>
                                            <label class="form-check-label">Diagn√≥stico Formal</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Experiencia Laboral</label>
                                        <textarea class="form-control" name="experiencia_laboral" rows="3">{{ user.experiencia_laboral or '' }}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Formaci√≥n Acad√©mica</label>
                                        <textarea class="form-control" name="formacion_academica" rows="3">{{ user.formacion_academica or '' }}</textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <h6>Habilidades y Adaptaciones</h6>
                                    <div class="mb-3">
                                        <label class="form-label">Habilidades</label>
                                        <textarea class="form-control" name="habilidades" rows="2">{{ user.habilidades or '' }}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Intereses Laborales</label>
                                        <textarea class="form-control" name="intereses_laborales" rows="2">{{ user.intereses_laborales or '' }}</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Adaptaciones Necesarias</label>
                                        <textarea class="form-control" name="adaptaciones_necesarias" rows="2">{{ user.adaptaciones_necesarias or '' }}</textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-success me-2">üíæ Guardar Cambios</button>
                                <a href="/usuarios-neurodivergentes" class="btn btn-secondary">‚ùå Cancelar</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('editUserForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {};
            for (let [key, value] of formData.entries()) {
                if (key === 'diagnostico_formal') {
                    data[key] = formData.has(key);
                } else {
                    data[key] = value;
                }
            }
            
            try {
                const response = await fetch(`/api/usuario/{{ user_id }}/editar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Usuario actualizado exitosamente');
                    window.location.href = '/usuarios-neurodivergentes';
                } else {
                    alert('‚ùå Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Error al guardar cambios');
            }
        });
    </script>
</body>
</html>